---
title: "Capstone"
author: "Sergii Sorokolat"
date: "7/15/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Define a function for reading from a file and sampling a small portion of the data

```{r}
readAndSampleFile <- function(fileName, sampleSize ) {
    
    con <- file(fileName, open = "r", encoding = "UTF-8")
    lines <- readLines(con)
    
    idxs <- sample(1:length(lines), sampleSize)
    vals <- c()
    
     for (i in 1:length(lines)) {
        if (i %in% idxs) {
           vals <- append(vals, lines[i])
        }
     }
    close(con)
    vals
}
```

## read and sample

```{r warning=FALSE}
setwd("~/Desktop/dscapstone/")
##setwd("~/GitHub/dscapstone/")

set.seed(7152018)

## sample size
s <- 50000
## samples <- c()

## samples <- append(samples, readAndSampleFile(fileName = "final/en_US/en_US.blogs.txt", s))
## samples <- append(samples, readAndSampleFile(fileName = "final/en_US/en_US.news.txt", s))
## samples <- append(samples, readAndSampleFile(fileName = "final/en_US/en_US.twitter.txt", s))

## cleanup
## gc()

## saveRDS(samples, "samples150k.rds")

samples <- readRDS("samples150k.rds")
## summary(samples)
```

## Profanity filtering
https://github.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words

```{r message=FALSE}
library(tidyverse)

filter <- read.csv("sanityfilter_en.txt", header = FALSE, sep = "\n", as.is = TRUE)$V1

## to lowercase
t <- tbl_df(samples)
t <- mutate(t, value = str_to_lower(value))

## build the grep filter
f1 <- c()
for (i in 1:length(filter)) {
  ## \\<word\\>
  word <- paste("\\<", filter[i] ,"\\>", sep = "")
  f1 <- append(f1, word)
}
f <- paste(f1, sep = "", collapse = "|")
t$sanity_failed <- grepl(paste("(", f, ")", sep = ""), t$value)
##t$value <- gsub(paste("(", f, ")", sep = ""), "0", t$value, fixed = TRUE)

##t <-readRDS("samples150k-sanityfilter.rds")
nrow(t[t$sanity_failed,])

saveRDS(t, "filtered.rds")

```





